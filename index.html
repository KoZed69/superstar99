<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GL99 - Professional View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --bg-body: #dfe3ee; --header-grad: linear-gradient(to bottom, #3b5998 0%, #1e5396 100%); --league-grad: linear-gradient(to bottom, #a90329 0%, #6d0019 100%); }
        body { background: var(--bg-body); font-family: Tahoma, sans-serif; font-size: 11px; overflow: hidden; }
        .top-header { background: var(--header-grad); height: 38px; display: flex; align-items: center; color: white; border-bottom: 1px solid #000; }
        .wrapper { display: flex; height: calc(100vh - 38px); }
        .sidebar { width: 220px; background: #f2f2f2; border-right: 1px solid #999; display: flex; flex-direction: column; }
        .main-view { flex: 1; overflow: hidden; background: white; padding: 5px; }
        .menu-link { display: flex; justify-content: space-between; padding: 4px 8px; cursor: pointer; border-bottom: 1px solid #ccc; font-weight: bold; }
        .menu-link:hover, .menu-link.active { background: #ffffcc; color: #a90329; border-left: 3px solid #a90329; }
        .data-table { width: 100%; border-collapse: collapse; border: 1px solid #999; }
        .th-std { background: #5c87b2; color: white; border: 1px solid #fff; padding: 3px; font-weight: bold; }
        .row-head { background: var(--league-grad); color: white; padding: 4px 8px; font-weight: bold; }
        .odd-btn { cursor: pointer; font-weight: bold; min-width: 45px; text-align: right; }
        .odd-btn:hover { background: #ffffcc; color: red; outline: 1px solid red; }
        .red { color: #cc0000; } .black { color: #000; }
    </style>
</head>
<body>
    <div class="top-header px-3">
        <div class="font-black italic text-yellow-400 text-lg mr-5">GL99</div>
        <div class="flex h-full text-xs font-bold">
            <div class="px-3 flex items-center bg-blue-900 border-r border-blue-400">Home</div>
            <div class="px-3 flex items-center border-r border-blue-400">Bet List</div>
            <div class="px-3 flex items-center border-r border-blue-400">Statement</div>
        </div>
        <div class="flex-1 text-right text-[10px] leading-tight pr-3">
            <span id="user-name" class="text-yellow-400 font-bold"></span> | <span id="bal" class="font-bold">...</span>
        </div>
        <button onclick="logout()" class="bg-red-700 px-2 py-1 rounded text-[10px]">Exit</button>
    </div>

    <div class="wrapper">
        <div class="sidebar">
            <div class="flex bg-gray-300 border-b border-gray-500 font-bold text-center">
                <div class="flex-1 py-1 cursor-pointer" onclick="setTab('Early')">Early</div>
                <div class="flex-1 py-1 bg-white text-red-700" onclick="setTab('Today')">Today</div>
                <div class="flex-1 py-1 cursor-pointer" onclick="setTab('Live')">Live</div>
            </div>
            <div class="flex-1 overflow-y-auto">
                <div class="p-1 font-bold text-blue-800"><i class="fas fa-futbol"></i> SOCCER</div>
                <div class="menu-link active"><span>HDP & OU</span> <span class="text-red-700">24</span></div>
                <div class="menu-link"><span>Odd/Even & Total Goal</span> <span class="text-red-700">356</span></div>
                <div class="menu-link"><span>1X2 & Double Chance</span> <span class="text-red-700">351</span></div>
                <div class="menu-link"><span>Correct Score</span> <span class="text-red-700">268</span></div>
                <div class="menu-link"><span>Mix Parlay</span> <span class="text-red-700">291</span></div>
                <button onclick="fetchOdds()" class="w-full mt-2 bg-blue-100 py-1 text-xs font-bold border-y border-blue-400">REFRESH DATA</button>
            </div>
        </div>

        <div class="main-view overflow-y-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th rowspan="2" class="th-std">Time/Event</th>
                        <th colspan="2" class="th-std">Full Time</th>
                        <th colspan="2" class="th-std">First Half</th>
                        <th rowspan="2" class="th-std">1X2</th>
                    </tr>
                    <tr>
                        <th class="th-std">HDP</th><th class="th-std">O/U</th>
                        <th class="th-std">HDP</th><th class="th-std">O/U</th>
                    </tr>
                </thead>
                <tbody id="match-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:3000' : '';
        const currentUser = JSON.parse(localStorage.getItem('gl99_user'));
        let allMatches = [], currentTab = 'Today';

        async function init() {
            if(!currentUser) return window.location.href = 'login.html';
            document.getElementById('user-name').innerText = currentUser.username;
            await fetchOdds(); syncUser();
        }

        async function syncUser() {
            const r = await fetch(`${API_BASE}/user/sync`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username:currentUser.username})});
            const d = await r.json(); document.getElementById('bal').innerText = d.balance.toLocaleString();
        }

        async function fetchOdds() {
            const res = await fetch(`${API_BASE}/odds`);
            allMatches = await res.json(); renderTable();
        }
    function setTab(tab) {
    currentTab = tab;
    // Tab ခလုတ်များ၏ အရောင်ကို ပြောင်းလဲခြင်း
    document.querySelectorAll('.sidebar .flex div').forEach(el => {
        el.classList.remove('bg-white', 'text-red-700');
        el.classList.add('cursor-pointer');
    });
    event.currentTarget.classList.add('bg-white', 'text-red-700');
    event.currentTarget.classList.remove('cursor-pointer');
    
    renderTable(); // ဇယားကို ပြန်လည်ဆွဲထုတ်ခြင်း
}    
    function renderTable() {
    const tbody = document.getElementById('match-body'); 
    tbody.innerHTML = '';
    const now = new Date();
    const todayEnd = new Date(); 
    todayEnd.setHours(23, 59, 59, 999);

    // Tab အလိုက် Filter လုပ်ခြင်း (Syntax error ပြင်ပြီး)
    let filtered = allMatches.filter(m => {
        const mTime = new Date(m.time); // ဤနေရာတွင် mTime ကို ဖွင့်ဆိုရမည်
        if (currentTab === 'Live') return m.isLive === true;
        if (currentTab === 'Today') return m.isLive === false && mTime <= todayEnd;
        if (currentTab === 'Early') return mTime > todayEnd;
        return true;
    });

    let leagueGroups = {};
    filtered.forEach(m => { 
        if(!leagueGroups[m.league]) leagueGroups[m.league]=[]; 
        leagueGroups[m.league].push(m); 
    });

    for(const [league, matches] of Object.entries(leagueGroups)) {
        tbody.innerHTML += `<tr><td colspan="6" class="row-head">${league}</td></tr>`;
        matches.forEach(m => {
            const time = new Date(m.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            
            // Live ပွဲများအတွက် အချိန်ပြသပုံ ပြင်ဆင်ခြင်း
            const timeDisplay = m.isLive ? `<span class="text-red-600 font-bold">${m.timer}' <br> ${m.score}</span>` : time;

            tbody.innerHTML += `
            <tr class="border-b border-gray-300">
                <td class="p-1 border-r bg-gray-50 text-[10px]">
                    <div class="text-gray-500">${timeDisplay}</div>
                    <div class="font-bold text-blue-900">${m.home}</div>
                    <div class="font-bold text-blue-900">${m.away}</div>
                </td>
                <td class="p-1 border-r text-center">
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-gray-600">${m.fullTime.hdp.label}</span>
                        <span class="odd-btn ${parseFloat(m.fullTime.hdp.h) < 0 ? 'text-red-600' : 'text-black'}">${m.fullTime.hdp.h}</span>
                    </div>
                    <div class="flex justify-end mt-1">
                        <span class="odd-btn ${parseFloat(m.fullTime.hdp.a) < 0 ? 'text-red-600' : 'text-black'}">${m.fullTime.hdp.a}</span>
                    </div>
                </td>
                <td class="p-1 border-r text-center">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-500">u${m.fullTime.ou.label}</span>
                        <span class="odd-btn text-blue-700">${m.fullTime.ou.o}</span>
                    </div>
                    <div class="flex justify-end mt-1">
                        <span class="odd-btn text-blue-700">${m.fullTime.ou.u}</span>
                    </div>
                </td>
                <td class="p-1 border-r bg-pink-50 text-center">
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-gray-500">${m.firstHalf.hdp.label}</span>
                        <span class="odd-btn">${m.firstHalf.hdp.h}</span>
                    </div>
                    <div class="flex justify-end mt-1">
                        <span class="odd-btn">${m.firstHalf.hdp.a}</span>
                    </div>
                </td>
                <td class="p-1 border-r bg-pink-50 text-center">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">u${m.firstHalf.ou.label}</span>
                        <span class="odd-btn">${m.firstHalf.ou.o}</span>
                    </div>
                    <div class="flex justify-end mt-1">
                        <span class="odd-btn">${m.firstHalf.ou.u}</span>
                    </div>
                </td>
                <td class="p-1 text-center font-bold">
                    <div class="odd-btn">${m.fullTime.xx.h}</div>
                    <div class="odd-btn">${m.fullTime.xx.a}</div>
                </td>
            </tr>`;
        });
    }
}
        
        function logout() { localStorage.removeItem('gl99_user'); window.location.href = 'login.html'; }
        init();
    </script>
</body>
</html>